generator client {
  provider = "prisma-client-js"
}

generator json {
  provider = "prisma-json-types-generator"
}
 
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

// the user... duh
model User {
  id               String  @id
  lifetimeMinutes  Int
  apiKey           String  @unique
  slackUser        SlackUser?
  sessions         Session[]

  // [UserMetaType]
  metadata         Json
}

// slack data of the user
model SlackUser {
  slackId          String  @id
  user             User    @relation(fields: [userId], references: [id])
  userId           String  @unique
  tz_offset        Int

  slackToken       String? // For future implementation
}

// tracks the user's hour (/hack)
model Session { // Hack Hour
  user       User  @relation(fields: [userId], references: [id])
  userId     String

  createdAt  DateTime @default(now()) @id

  time       Int
  elapsed    Int

  //elapsedSincePause Int - rework this

  completed  Boolean
  cancelled  Boolean
  paused     Boolean

  /// [SessionMetaType]
  metadata   Json
  
  messageTs  String 
  controlTs  String 
}

// Categorizes the user's sessions (group)
//model Goal { // Group
//  id          String  @id
//  user        User    @relation(fields: [userId], references: [id])
//  userId      String

//  name        String
//  description String

//  totalMinutes Int
//  createdAt   DateTime

//  selected    Boolean

//  completed   Boolean @default(false)
//  metadata    Json?

//  sessions    Session[]
//}

// Ship posts & etc. - anything that counts as a banked hour
//model Bank { 
//  id          String  @id
//  user        User    @relation(fields: [userId], references: [id])
//  userId      String

//  minutes     Int

//  approved    Boolean @default(false)

//  type        String // "ship"/"ysws"/"scrapbook"

//  createdAt   DateTime @default(now())
//  updatedAt   DateTime @updatedAt
//lastBankedAt DateTime

//  sessions    Session[]

//  data    Json
  // { "shipLink": "URL", "goalId": "###" }
//}